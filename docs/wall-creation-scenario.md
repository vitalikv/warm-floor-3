# ะกัะตะฝะฐัะธะน ัะพะทะดะฐะฝะธั ััะตะฝั

> **ะัะฝะพะฒะฐะฝะพ ะฝะฐ:** ะะฝะฐะปะธะท ะฟัะพะตะบัะฐ `ocsg-1/p1`
> **ะะฐัะฐ:** 2026-02-08
> **ะกัะฐััั:** ๐ ะะปะฐะฝะธัะพะฒะฐะฝะธะต

## ะะฑะทะพั

ะกะพะทะดะฐะฝะธะต ััะตะฝั โ ััะพ ะธะฝัะตัะฐะบัะธะฒะฝัะน ะฟัะพัะตัั, ะบะพัะพััะน ะฐะบัะธะฒะธััะตััั ะบะฝะพะฟะบะพะน ะฒ ะฟัะฐะฒะพะน ะฟะฐะฝะตะปะธ UI ะธ ะฟะพะทะฒะพะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐัะธัะพะฒะฐัั ััะตะฝั ั ะฟะพะผะพััั ะดะฒัั ะบะปะธะบะพะฒ ะผััะธ ะฒ 3D ััะตะฝะต.

## ะัะฝะพะฒะฝะพะน ััะตะฝะฐัะธะน (Happy Path)

### 1. ะะบัะธะฒะฐัะธั ัะตะถะธะผะฐ ัะพะทะดะฐะฝะธั ััะตะฝั

**ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั:** ะะปะธะบ ะฟะพ ะบะฝะพะฟะบะต "ะกะพะทะดะฐัั ััะตะฝั" ะฒ ะฟัะฐะฒะพะน ะฟะฐะฝะตะปะธ

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
UI (RightPanel)
  โโ> ApiUiToThree.activateWallCreationMode()
      โโ> InteractionOrchestrator.setMode('CREATE_WALL')
          โโ> ModeManager.switchTo(WallCreationMode)
              โโ> ะัะบะปััะธัั OrbitControls (ััะพะฑั ะบะปะธะบ ะฝะต ะดะฒะธะณะฐะป ะบะฐะผะตัั)
              โโ> ะะทะผะตะฝะธัั ะบัััะพั (crosshair ะธะปะธ custom)
              โโ> ะฃััะฐะฝะพะฒะธัั ัะปะฐะณ isToolActive = true
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- ะะฝะพะฟะบะฐ "ะกะพะทะดะฐัั ััะตะฝั" ะฟะพะดัะฒะตัะธะฒะฐะตััั ะบะฐะบ ะฐะบัะธะฒะฝะฐั
- ะัััะพั ะผะตะฝัะตััั ะฝะฐ crosshair (+) ะธะปะธ ะธะบะพะฝะบั ััะตะฝั
- (ะะฟัะธะพะฝะฐะปัะฝะพ) ะะพะบะฐะทะฐัั hint: "ะะปะธะบะฝะธัะต, ััะพะฑั ัะฐะทะผะตััะธัั ะฟะตัะฒัั ัะพัะบั ััะตะฝั"

---

### 2. ะะตัะฒัะน ะบะปะธะบ โ ัะฐะทะผะตัะตะฝะธะต ะฟะตัะฒะพะน ัะพัะบะธ

**ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั:** ะะปะธะบ ะปะตะฒะพะน ะบะฝะพะฟะบะพะน ะผััะธ ะฒ ะปัะฑะพะผ ะผะตััะต ััะตะฝั

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
WallCreationMode.handlePointerDown(event)
  โโ> RaycastService.raycastFloor(event)  // ะัั ะบ ะฟะปะพัะบะพััะธ ะฟะพะปะฐ (Y=0)
      โโ> ะะพะปััะธัั ะฟะพะทะธัะธั (x, y=0, z)
          โโ> PointsManager.createTemporaryPoint(position)
              โโ> ะกะพะทะดะฐัั PointWall mesh ะฒ ะฟะพะทะธัะธะธ ะบะปะธะบะฐ
              โโ> ะฃััะฐะฝะพะฒะธัั userData.type = 'wall_creation_start'
              โโ> ะฃััะฐะฝะพะฒะธัั userData.isTemporary = true
              โโ> ะะพะฑะฐะฒะธัั ัะพัะบั ะฒ ััะตะฝั
              โโ> ะกะพััะฐะฝะธัั ัััะปะบั firstPoint
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- ะะพัะฒะปัะตััั ััะตัะฐ (ัะพัะบะฐ) ะฒ ะผะตััะต ะบะปะธะบะฐ
- ะขะพัะบะฐ ะผะพะถะตั ะฑััั ะดััะณะพะณะพ ัะฒะตัะฐ (ะฝะฐะฟัะธะผะตั, ะณะพะปัะฑะฐั ะฒะผะตััะพ ััะฐะฝะดะฐััะฝะพะน)
- Hint ะผะตะฝัะตััั: "ะะปะธะบะฝะธัะต, ััะพะฑั ัะฐะทะผะตััะธัั ะฒัะพััั ัะพัะบั" ะธะปะธ "ะะตัะตะผะตััะธัะต ะผััั ะธ ะบะปะธะบะฝะธัะต ะดะปั ะทะฐะฒะตััะตะฝะธั"

---

### 3. ะะตัะตะผะตัะตะฝะธะต ะผััะธ โ ะฒะธะทัะฐะปัะฝัะน preview ััะตะฝั

**ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั:** ะะฒะธะถะตะฝะธะต ะผััะธ ะฟะพัะปะต ะฟะตัะฒะพะณะพ ะบะปะธะบะฐ (ะฑะตะท ัะดะตัะถะฐะฝะธั ะบะฝะพะฟะบะธ)

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
WallCreationMode.handlePointerMove(event)
  โโ> RaycastService.raycastFloor(event)
      โโ> ะะพะปััะธัั ัะตะบัััั ะฟะพะทะธัะธั ะบัััะพัะฐ (x, y=0, z)
          โโ> WallPreview.update(firstPoint.position, currentPosition)
              โโ> ะกะพะทะดะฐัั/ะพะฑะฝะพะฒะธัั ะฒัะตะผะตะฝะฝัั ะณะตะพะผะตััะธั ััะตะฝั
              โโ> ะัะพะฑัะฐะทะธัั ะฟะพะปัะฟัะพะทัะฐัะฝัั ััะตะฝั (opacity: 0.5)
              โโ> ะะพะบะฐะทะฐัั ัะฐะทะผะตัั ััะตะฝั (ะดะปะธะฝะฐ, ัะพะปัะธะฝะฐ)
              โโ> ะกะพะทะดะฐัั ะฒัะตะผะตะฝะฝัั ะฒัะพััั ัะพัะบั ะฝะฐ ะบัััะพัะต
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- ะะพะปัะฟัะพะทัะฐัะฝะฐั ััะตะฝะฐ "ััะฝะตััั" ะพั ะฟะตัะฒะพะน ัะพัะบะธ ะบ ะบัััะพัั
- ะะฐ ะบัััะพัะต ะพัะพะฑัะฐะถะฐะตััั ะฒัะตะผะตะฝะฝะฐั ะฒัะพัะฐั ัะพัะบะฐ (ghost point)
- ะัะดะพะผ ัะพ ััะตะฝะพะน ะฟะพะบะฐะทัะฒะฐะตััั ัะตะบัั ั ะดะปะธะฝะพะน (ะฝะฐะฟัะธะผะตั, "3.2 ะผ")
- ะกัะตะฝะฐ ะผะพะถะตั ะผะตะฝััั ัะฒะตั ะฟัะธ ะฟะตัะตัะตัะตะฝะธะธ ั ะดััะณะธะผะธ ะพะฑัะตะบัะฐะผะธ (ะบัะฐัะฝัะน = invalid)

---

### 4. ะัะพัะพะน ะบะปะธะบ โ ะทะฐะฒะตััะตะฝะธะต ัะพะทะดะฐะฝะธั ััะตะฝั

**ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั:** ะัะพัะพะน ะบะปะธะบ ะปะตะฒะพะน ะบะฝะพะฟะบะพะน ะผััะธ

**ะงัะพ ะฟัะพะธััะพะดะธั:**

#### 4.1. ะะฟัะตะดะตะปะตะฝะธะต ัะธะฟะฐ ะบะปะธะบะฐ

```
WallCreationMode.handlePointerDown(event)
  โโ> RaycastService.raycastAll(event)
      โโ> ะัะพะฒะตัะธัั ะฟะตัะตัะตัะตะฝะธะต ั ะพะฑัะตะบัะฐะผะธ
          โโ> ะกะปััะฐะน A: ะะปะธะบ ะฝะฐ ะดััะณัั ัััะตััะฒััััั ัะพัะบั
          โโ> ะกะปััะฐะน B: ะะปะธะบ ะฝะฐ ัััะตััะฒััััั ััะตะฝั
          โโ> ะกะปััะฐะน C: ะะปะธะบ ะฝะฐ ะฟัััะพะต ะผะตััะพ (floor)
```

#### 4.2. ะกะปััะฐะน A: ะะปะธะบ ะฝะฐ ัััะตััะฒััััั ัะพัะบั

```
PointsManager.getPointAtPosition(clickPosition)
  โโ> ะะฐะนะดะตะฝะฐ ัััะตััะฒัััะฐั ัะพัะบะฐ (existingPoint)
      โโ> WallsManager.createWall({
            point1: firstPoint,
            point2: existingPoint
          })
          โโ> ะัะพะฒะตัะธัั ะฒะฐะปะธะดะฝะพััั (ัะฐัััะพัะฝะธะต > minWallLength)
          โโ> ะกะพะทะดะฐัั Wall ะพะฑัะตะบั
          โโ> ะกะฒัะทะฐัั ัะพัะบะธ ั ััะตะฝะพะน (point1.walls.push(wall))
          โโ> ะะพะฑะฐะฒะธัั ััะตะฝั ะฒ ััะตะฝั
          โโ> ะฃะดะฐะปะธัั ะฒัะตะผะตะฝะฝัั ัะพัะบั firstPoint
          โโ> ะัะฟะพะปัะทะพะฒะฐัั existingPoint ะบะฐะบ ะฒัะพััั ัะพัะบั
          โโ> ApiThreeToUi.onWallCreated(wall)
              โโ> ะะฑะฝะพะฒะธัั UI (ัะฟะธัะพะบ ััะตะฝ, ัะฒะพะนััะฒะฐ)
```

**ะะตะทัะปััะฐั:**
- ะกัะตะฝะฐ ัะพะตะดะธะฝัะตั firstPoint ะธ existingPoint
- firstPoint ััะฐะฝะพะฒะธััั ะฟะพััะพัะฝะฝะพะน ัะพัะบะพะน (isTemporary = false)
- ะะฑะต ัะพัะบะธ ัะตะฟะตัั ัะฒัะทะฐะฝั ััะตะฝะพะน

#### 4.3. ะกะปััะฐะน B: ะะปะธะบ ะฝะฐ ัััะตััะฒััััั ััะตะฝั

```
WallsManager.getWallAtPosition(clickPosition)
  โโ> ะะฐะนะดะตะฝะฐ ััะตะฝะฐ (existingWall)
      โโ> WallsManager.splitWall({
            wall: existingWall,
            splitPosition: clickPosition
          })
          โโ> ะกะพะทะดะฐัั ะฝะพะฒัั ัะพัะบั ะฒ ะผะตััะต ะบะปะธะบะฐ (splitPoint)
          โโ> ะะฐะทะดะตะปะธัั existingWall ะฝะฐ ะดะฒะต ััะตะฝั:
          โ   โโ wall_1: ะพั ััะฐัะพะน ัะพัะบะธ1 ะดะพ splitPoint
          โ   โโ wall_2: ะพั splitPoint ะดะพ ััะฐัะพะน ัะพัะบะธ2
          โโ> ะฃะดะฐะปะธัั existingWall
          โโ> ะกะพะทะดะฐัั ะฝะพะฒัั ััะตะฝั ะพั firstPoint ะดะพ splitPoint
          โโ> ApiThreeToUi.onWallCreated(newWall)
```

**ะะตะทัะปััะฐั:**
- ะกัะฐัะฐั ััะตะฝะฐ ัะฐะทะดะตะปะตะฝะฐ ะฝะฐ ะดะฒะต ัะฐััะธ
- ะะพะฒะฐั ััะตะฝะฐ ะพัะฒะตัะฒะปัะตััั ะพั ัะพัะบะธ ัะฐะทะดะตะปะตะฝะธั
- ะ ัะพัะบะต ัะฐะทะดะตะปะตะฝะธั ัะตะฟะตัั 3 ััะตะฝั ััะพะดัััั

#### 4.4. ะกะปััะฐะน C: ะะปะธะบ ะฝะฐ ะฟัััะพะต ะผะตััะพ

```
RaycastService.raycastFloor(event)
  โโ> ะะพะปััะธัั ะฟะพะทะธัะธั (x, y=0, z)
      โโ> PointsManager.createPoint(position)
          โโ> ะกะพะทะดะฐัั ะฝะพะฒัั ะฟะพััะพัะฝะฝัั ัะพัะบั (secondPoint)
          โโ> WallsManager.createWall({
                point1: firstPoint,
                point2: secondPoint
              })
              โโ> ะกะพะทะดะฐัั Wall ะพะฑัะตะบั
              โโ> ะกะฒัะทะฐัั ัะพัะบะธ ั ััะตะฝะพะน
              โโ> ะะพะฑะฐะฒะธัั ััะตะฝั ะฒ ััะตะฝั
              โโ> firstPoint.isTemporary = false
              โโ> ApiThreeToUi.onWallCreated(wall)
```

**ะะตะทัะปััะฐั:**
- ะกะพะทะดะฐะฝะฐ ะฝะพะฒะฐั ััะตะฝะฐ ั ะดะฒัะผั ะฝะพะฒัะผะธ ัะพัะบะฐะผะธ
- ะะฑะต ัะพัะบะธ ะฟะพััะพัะฝะฝัะต

---

### 5. ะัะพะดะพะปะถะตะฝะธะต ัะธัะพะฒะฐะฝะธั (Chain Mode)

**ะะพะฒะตะดะตะฝะธะต ะฟะพัะปะต ะทะฐะฒะตััะตะฝะธั ััะตะฝั:**

```
WallCreationMode (ะฟะพัะปะต ัะพะทะดะฐะฝะธั ััะตะฝั)
  โโ> if (continuousDrawing enabled)
      โโ> ะฃััะฐะฝะพะฒะธัั secondPoint ะบะฐะบ ะฝะพะฒัั firstPoint
      โโ> ะัะธััะธัั preview
      โโ> ะะถะธะดะฐัั ัะปะตะดัััะธะน ะบะปะธะบ (ะฒะตัะฝััััั ะบ ัะฐะณั 3)
      โโ> Hint: "ะัะพะดะพะปะถะฐะนัะต ัะธัะพะฒะฐัั ะธะปะธ ะฝะฐะถะผะธัะต ESC ะดะปั ะฒััะพะดะฐ"

  โโ> if (continuousDrawing disabled)
      โโ> WallCreationMode.exit()
          โโ> ะัะธััะธัั ะฒัะตะผะตะฝะฝัะต ะพะฑัะตะบัั
          โโ> ะกะฑัะพัะธัั ัะตะถะธะผ ะฝะฐ default
          โโ> ะะพัััะฐะฝะพะฒะธัั OrbitControls
          โโ> ะะตัะฝััั ะบัััะพั
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- ะะพัะปะตะดะฝัั ัะพัะบะฐ ัะพะทะดะฐะฝะฝะพะน ััะตะฝั ััะฐะฝะพะฒะธััั ะฐะบัะธะฒะฝะพะน (ะฟะพะดัะฒะตัะตะฝะฐ)
- Preview ััะตะฝั ัะฝะพะฒะฐ ัะปะตะดัะตั ะทะฐ ะบัััะพัะพะผ ะพั ััะพะน ัะพัะบะธ
- ะะพะถะฝะพ ะฟัะพะดะพะปะถะธัั ัะธัะพะฒะฐัั ัะตะฟะพัะบั ััะตะฝ

---

## ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะดะตะนััะฒะธั

### ะัะผะตะฝะฐ ัะพะทะดะฐะฝะธั ััะตะฝั (ESC ะธะปะธ ะฟัะฐะฒัะน ะบะปะธะบ)

**ะะตะนััะฒะธะต ะฟะพะปัะทะพะฒะฐัะตะปั:** ะะฐะถะฐัะธะต ESC ะธะปะธ ะฟัะฐะฒัะน ะบะปะธะบ ะผััะธ

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
WallCreationMode.cancel()
  โโ> ะฃะดะฐะปะธัั ะฒัะตะผะตะฝะฝัั firstPoint (ะตัะปะธ isTemporary)
  โโ> ะฃะดะฐะปะธัั preview ััะตะฝั
  โโ> ะฃะดะฐะปะธัั ะฒัะตะผะตะฝะฝัั ะฒัะพััั ัะพัะบั
  โโ> ะัะธััะธัั ัะพััะพัะฝะธะต ัะตะถะธะผะฐ
  โโ> WallCreationMode.exit()
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- ะัะต ะฒัะตะผะตะฝะฝัะต ะพะฑัะตะบัั ะธััะตะทะฐัั
- ะะฝะพะฟะบะฐ "ะกะพะทะดะฐัั ััะตะฝั" ะดะตะฐะบัะธะฒะธััะตััั
- ะัััะพั ะฒะพะทะฒัะฐัะฐะตััั ะบ ะฝะพัะผะฐะปัะฝะพะผั
- ะะพัััะฐะฝะฐะฒะปะธะฒะฐะตััั OrbitControls

---

### ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต (Snap to Grid)

**ะฃัะปะพะฒะธะต:** ะัะปะธ ะฐะบัะธะฒะฝะฐ ะฟัะธะฒัะทะบะฐ ะบ ัะตัะบะต

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
WallCreationMode.handlePointerMove(event)
  โโ> RaycastService.raycastFloor(event)
      โโ> position = getPosition()
          โโ> if (snapToGrid enabled)
              โโ> SnapBehavior.snapToGrid(position, gridSize)
              โ   โโ> position.x = Math.round(position.x / gridSize) * gridSize
              โ   โโ> position.z = Math.round(position.z / gridSize) * gridSize
              โโ> WallPreview.update(firstPoint, snappedPosition)
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- ะัััะพั "ะฟััะณะฐะตั" ะฟะพ ัะทะปะฐะผ ัะตัะบะธ
- ะัะตะผะตะฝะฝะฐั ัะพัะบะฐ ะธ ััะตะฝะฐ ะฟะพะทะธัะธะพะฝะธัััััั ัััะพะณะพ ะฟะพ ัะตัะบะต
- ะะฐะทะผะตัั ััะตะฝั ะบัะฐัะฝั ัะฐะทะผะตัั ััะตะนะบะธ ัะตัะบะธ

---

### ะัะธะฒัะทะบะฐ ะบ ัะพัะบะฐะผ (Snap to Points)

**ะฃัะปะพะฒะธะต:** ะัััะพั ะฟัะธะฑะปะธะถะฐะตััั ะบ ัััะตััะฒัััะตะน ัะพัะบะต

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
WallCreationMode.handlePointerMove(event)
  โโ> PointsManager.findNearbyPoints(cursorPosition, snapRadius)
      โโ> if (nearbyPoint exists && distance < snapRadius)
          โโ> ะะพะดัะฒะตัะธัั nearbyPoint (hover effect)
          โโ> ะัะธะฒัะทะฐัั preview ะบ ะฟะพะทะธัะธะธ nearbyPoint
          โโ> ะะพะบะฐะทะฐัั tooltip: "ะกะพะตะดะธะฝะธัั ั ัะพัะบะพะน"
          โโ> WallPreview.update(firstPoint, nearbyPoint.position)
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- ะะปะธะถะฐะนัะฐั ัะพัะบะฐ ัะฒะตะปะธัะธะฒะฐะตััั ะธะปะธ ะผะตะฝัะตั ัะฒะตั
- Cursor "ะฟัะธะผะฐะณะฝะธัะธะฒะฐะตััั" ะบ ัะพัะบะต
- Tooltip ะฟะพะบะฐะทัะฒะฐะตั "ะกะพะตะดะธะฝะธัั ั ัะพัะบะพะน"

---

### ะัะธะฒัะทะบะฐ ะบ ััะตะฝะฐะผ (Snap to Walls)

**ะฃัะปะพะฒะธะต:** ะัััะพั ะฟัะธะฑะปะธะถะฐะตััั ะบ ัััะตััะฒัััะตะน ััะตะฝะต

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
WallCreationMode.handlePointerMove(event)
  โโ> WallsManager.findNearbyWalls(cursorPosition, snapRadius)
      โโ> if (nearbyWall exists && distance < snapRadius)
          โโ> ะััะธัะปะธัั ะฑะปะธะถะฐะนััั ัะพัะบั ะฝะฐ ััะตะฝะต (perpendicular)
          โโ> ะะพะดัะฒะตัะธัั nearbyWall (hover effect)
          โโ> ะะพะบะฐะทะฐัั ะฒัะตะผะตะฝะฝัั ัะพัะบั ะฒ ะผะตััะต ะฑัะดััะตะณะพ ัะฐะทะดะตะปะตะฝะธั
          โโ> ะะพะบะฐะทะฐัั tooltip: "ะะฐะทะดะตะปะธัั ััะตะฝั"
          โโ> WallPreview.update(firstPoint, snapPosition)
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- ะกัะตะฝะฐ ะฟะพะดัะฒะตัะธะฒะฐะตััั ะฟัะธ ะฝะฐะฒะตะดะตะฝะธะธ
- ะะพัะฒะปัะตััั ะผะฐะปะตะฝัะบะฐั ัะพัะบะฐ ะฒ ะผะตััะต ะฑัะดััะตะณะพ ัะฐะทะดะตะปะตะฝะธั
- Tooltip ะฟะพะบะฐะทัะฒะฐะตั "ะะฐะทะดะตะปะธัั ััะตะฝั"

---

### ะะฐะปะธะดะฐัะธั ะผะธะฝะธะผะฐะปัะฝะพะน ะดะปะธะฝั ััะตะฝั

**ะฃัะปะพะฒะธะต:** ะัะพะฒะตัะบะฐ ะฟะตัะตะด ัะพะทะดะฐะฝะธะตะผ ััะตะฝั

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
WallsManager.createWall({point1, point2})
  โโ> distance = point1.position.distanceTo(point2.position)
      โโ> if (distance < minWallLength)
          โโ> ะัะผะตะฝะธัั ัะพะทะดะฐะฝะธะต ััะตะฝั
          โโ> ะะพะบะฐะทะฐัั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต: "ะกัะตะฝะฐ ัะปะธัะบะพะผ ะบะพัะพัะบะฐั (ะผะธะฝ. 0.5 ะผ)"
          โโ> ะะพัะฟัะพะธะทะฒะตััะธ ะทะฒัะบ ะพัะธะฑะบะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
          โโ> ะะตัะฝััั ะบัััะพั ะบ ัะตะถะธะผั ะพะถะธะดะฐะฝะธั ะฒัะพัะพะณะพ ะบะปะธะบะฐ
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- Preview ััะตะฝั ะพะบัะฐัะธะฒะฐะตััั ะฒ ะบัะฐัะฝัะน ัะฒะตั
- Tooltip ะฟะพะบะฐะทัะฒะฐะตั "ะกะปะธัะบะพะผ ะบะพัะพัะบะฐั ััะตะฝะฐ"
- ะะปะธะบ ะฝะต ัะพะทะดะฐะตั ััะตะฝั

---

### ะัะตะดะพัะฒัะฐัะตะฝะธะต ะดัะฑะปะธัะพะฒะฐะฝะธั ััะตะฝ

**ะฃัะปะพะฒะธะต:** ะัะพะฒะตัะบะฐ, ะฝะต ัััะตััะฒัะตั ะปะธ ัะถะต ััะตะฝะฐ ะผะตะถะดั ะดะฒัะผั ัะพัะบะฐะผะธ

**ะงัะพ ะฟัะพะธััะพะดะธั:**
```
WallsManager.createWall({point1, point2})
  โโ> if (WallsManager.wallExistsBetween(point1, point2))
      โโ> ะัะผะตะฝะธัั ัะพะทะดะฐะฝะธะต ััะตะฝั
      โโ> ะะพะบะฐะทะฐัั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต: "ะกัะตะฝะฐ ะผะตะถะดั ััะธะผะธ ัะพัะบะฐะผะธ ัะถะต ัััะตััะฒัะตั"
      โโ> ะะตัะฝััััั ะบ ัะตะถะธะผั ะพะถะธะดะฐะฝะธั
```

**ะะธะทัะฐะปัะฝะฐั ะพะฑัะฐัะฝะฐั ัะฒัะทั:**
- Preview ััะตะฝั ะพะบัะฐัะธะฒะฐะตััั ะฒ ะพัะฐะฝะถะตะฒัะน ัะฒะตั
- Tooltip ะฟะพะบะฐะทัะฒะฐะตั "ะกัะตะฝะฐ ัะถะต ัััะตััะฒัะตั"
- ะะปะธะบ ะฝะต ัะพะทะดะฐะตั ะดัะฑะปะธะบะฐั

---

## ะกะพััะพัะฝะธั ัะตะถะธะผะฐ ัะพะทะดะฐะฝะธั ััะตะฝั

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   INACTIVE          โ  ะะตะถะธะผ ะฝะต ะฐะบัะธะฒะตะฝ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ ะะปะธะบ ะฝะฐ ะบะฝะพะฟะบั "ะกะพะทะดะฐัั ััะตะฝั"
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   WAITING_FIRST     โ  ะะถะธะดะฐะฝะธะต ะฟะตัะฒะพะณะพ ะบะปะธะบะฐ
โ   POINT             โ  - ะัััะพั: crosshair
โโโโโโโโฌโโโโโโโโโโโโโโโ  - Controls: disabled
       โ ะะตัะฒัะน ะบะปะธะบ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   PLACING_SECOND    โ  ะะฐะทะผะตัะตะฝะธะต ะฒัะพัะพะน ัะพัะบะธ
โ   POINT             โ  - ะะพะบะฐะท preview ััะตะฝั
โโโโโโโโฌโโโโโโโโโโโโโโโ  - ะัะตะผะตะฝะฝะฐั ะฒัะพัะฐั ัะพัะบะฐ
       โ ะัะพัะพะน ะบะปะธะบ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   CREATING_WALL     โ  ะกะพะทะดะฐะฝะธะต ััะตะฝั
โ                     โ  - ะะฐะปะธะดะฐัะธั
โโโโโโโโฌโโโโโโโโโโโโโโโ  - ะกะพะทะดะฐะฝะธะต ะพะฑัะตะบัะพะฒ
       โ
       โโโ> Success โโโโ> CONTINUOUS_MODE (ะตัะปะธ ะฒะบะปััะตะฝ)
       โ                      โ
       โ                      โโโ> ะะตัะฝััััั ะบ PLACING_SECOND
       โ                           (ั ะฝะพะฒะพะน firstPoint)
       โ
       โโโ> Success โโโโ> INACTIVE (ะตัะปะธ continuous ะฒัะบะปััะตะฝ)


โโโโโโโโโโโโโโโโโโโโโโโ
โ   CONTINUOUS_MODE   โ  ะะตะฟัะตััะฒะฝะพะต ัะธัะพะฒะฐะฝะธะต
โ                     โ  - ะะพัะปะตะดะฝัั ัะพัะบะฐ = ะฝะพะฒะฐั ะฟะตัะฒะฐั
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ ESC ะธะปะธ ะฟัะฐะฒัะน ะบะปะธะบ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   INACTIVE          โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ ัะตะฐะปะธะทะฐัะธะธ

### ะกัััะบัััะฐ ะดะฐะฝะฝัั

```typescript
// ะะตะถะธะผ ัะพะทะดะฐะฝะธั ััะตะฝั
class WallCreationMode extends Mode {
  private firstPoint: PointWall | null = null;
  private previewWall: Mesh | null = null;
  private previewSecondPoint: Mesh | null = null;
  private isActive: boolean = false;
  private continuousDrawing: boolean = true;
  private snapToGrid: boolean = false;
  private snapRadius: number = 0.3;
  private minWallLength: number = 0.5;
}

// ะัะตะผะตะฝะฝะฐั ัะพัะบะฐ
interface TemporaryPoint {
  mesh: PointWall;
  isTemporary: boolean;
  type: 'wall_creation_start' | 'wall_creation_preview';
}

// Preview ััะตะฝั
interface WallPreview {
  mesh: Mesh;
  geometry: BufferGeometry;
  material: MeshStandardMaterial;  // ะก opacity: 0.5
  dimensions: { length: number; width: number; height: number };
}
```

### ะกะพะฑััะธั (EventBus)

```typescript
// ะกะพะฑััะธั, ะบะพัะพััะต ะณะตะฝะตัะธััะตั ัะตะถะธะผ
EventBus.emit('wall:creation:started');
EventBus.emit('wall:creation:first-point-placed', { point });
EventBus.emit('wall:creation:preview-updated', { wall, length });
EventBus.emit('wall:creation:completed', { wall });
EventBus.emit('wall:creation:cancelled');
EventBus.emit('wall:creation:error', { error, message });
```

### ะะพะผะฐะฝะดั ะดะปั Undo/Redo

```typescript
class CreateWallCommand implements Command {
  private wall: Wall;
  private point1: PointWall;
  private point2: PointWall;
  private wasPoint1New: boolean;
  private wasPoint2New: boolean;

  execute() {
    // ะกะพะทะดะฐัั ััะตะฝั
    this.wall = WallsManager.inst().createWall({
      point1: this.point1,
      point2: this.point2
    });
  }

  undo() {
    // ะฃะดะฐะปะธัั ััะตะฝั
    WallsManager.inst().deleteWall(this.wall);

    // ะฃะดะฐะปะธัั ัะพัะบะธ, ะตัะปะธ ะพะฝะธ ะฑัะปะธ ะฝะพะฒัะผะธ
    if (this.wasPoint1New) {
      PointsManager.inst().deletePoint(this.point1);
    }
    if (this.wasPoint2New) {
      PointsManager.inst().deletePoint(this.point2);
    }
  }

  redo() {
    this.execute();
  }
}
```

---

## API ะผะตัะพะดั

### UI โ Three.js (ApiUiToThree)

```typescript
// ะะบัะธะฒะฐัะธั ัะตะถะธะผะฐ ัะพะทะดะฐะฝะธั ััะตะฝั
ApiUiToThree.activateWallCreationMode(options?: {
  continuousDrawing?: boolean;
  snapToGrid?: boolean;
  defaultHeight?: number;
  defaultWidth?: number;
}): void

// ะะตะฐะบัะธะฒะฐัะธั ัะตะถะธะผะฐ
ApiUiToThree.deactivateWallCreationMode(): void

// ะัะผะตะฝะฐ ัะตะบััะตะณะพ ะฟัะพัะตััะฐ ัะพะทะดะฐะฝะธั
ApiUiToThree.cancelWallCreation(): void
```

### Three.js โ UI (ApiThreeToUi)

```typescript
// ะฃะฒะตะดะพะผะปะตะฝะธะต ะพ ัะพะทะดะฐะฝะฝะพะน ััะตะฝะต
ApiThreeToUi.onWallCreated(wall: Wall): void

// ะฃะฒะตะดะพะผะปะตะฝะธะต ะพะฑ ะพัะธะฑะบะต
ApiThreeToUi.onWallCreationError(error: {
  code: 'TOO_SHORT' | 'ALREADY_EXISTS' | 'INVALID_POSITION';
  message: string;
}): void

// ะะฑะฝะพะฒะปะตะฝะธะต preview ะดะฐะฝะฝัั
ApiThreeToUi.onWallPreviewUpdated(data: {
  length: number;
  isValid: boolean;
}): void
```

---

## UI ะบะพะผะฟะพะฝะตะฝัั

### ะะฝะพะฟะบะฐ ะฒ ะฟัะฐะฒะพะน ะฟะฐะฝะตะปะธ

```typescript
// RightPanel.ts
class RightPanel {
  private wallButton: HTMLButtonElement;

  private createWallButton() {
    this.wallButton = document.createElement('button');
    this.wallButton.textContent = 'ะกะพะทะดะฐัั ััะตะฝั';
    this.wallButton.className = 'tool-button';

    this.wallButton.addEventListener('click', () => {
      this.activateWallCreation();
    });

    this.container.appendChild(this.wallButton);
  }

  private activateWallCreation() {
    // ะะตะฐะบัะธะฒะธัะพะฒะฐัั ะดััะณะธะต ะบะฝะพะฟะบะธ
    this.deactivateAllTools();

    // ะะบัะธะฒะธัะพะฒะฐัั ััั ะบะฝะพะฟะบั
    this.wallButton.classList.add('active');

    // ะะฐะฟัััะธัั ัะตะถะธะผ ะฒ Three.js
    ApiUiToThree.inst().activateWallCreationMode({
      continuousDrawing: true,
      snapToGrid: false
    });
  }

  public deactivateWallCreation() {
    this.wallButton.classList.remove('active');
  }
}
```

### Tooltip / Hint panel

```typescript
class WallCreationHint {
  private container: HTMLDivElement;

  show(message: string) {
    this.container.textContent = message;
    this.container.style.display = 'block';
  }

  hide() {
    this.container.style.display = 'none';
  }

  // ะัะธะผะตัั ัะพะพะฑัะตะฝะธะน:
  // "ะะปะธะบะฝะธัะต, ััะพะฑั ัะฐะทะผะตััะธัั ะฟะตัะฒัั ัะพัะบั ััะตะฝั"
  // "ะะปะธะบะฝะธัะต, ััะพะฑั ะทะฐะฒะตััะธัั ััะตะฝั (ะดะปะธะฝะฐ: 3.2 ะผ)"
  // "ะะฐะถะผะธัะต ESC ะดะปั ะพัะผะตะฝั"
}
```

### Dimension label (ัะฐะทะผะตัั ััะตะฝั)

```typescript
class WallDimensionLabel {
  private label: HTMLDivElement;

  update(length: number, screenPosition: Vector2) {
    this.label.textContent = `${length.toFixed(2)} ะผ`;
    this.label.style.left = `${screenPosition.x}px`;
    this.label.style.top = `${screenPosition.y}px`;
  }

  hide() {
    this.label.style.display = 'none';
  }
}
```

---

## ะะฐัััะพะนะบะธ ัะตะถะธะผะฐ

ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะฝะฐัััะพะธัั:

1. **ะะตะฟัะตััะฒะฝะพะต ัะธัะพะฒะฐะฝะธะต** (`continuousDrawing`): ะฟะพัะปะต ัะพะทะดะฐะฝะธั ััะตะฝั ะฟัะพะดะพะปะถะธัั ัะธัะพะฒะฐัั ะพั ะฟะพัะปะตะดะฝะตะน ัะพัะบะธ
2. **ะัะธะฒัะทะบะฐ ะบ ัะตัะบะต** (`snapToGrid`): ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะฒััะฐะฒะฝะธะฒะฐะฝะธะต ะฟะพ ัะตัะบะต
3. **ะะฐะดะธัั ะฟัะธะฒัะทะบะธ** (`snapRadius`): ัะฐัััะพัะฝะธะต ะดะปั snap ะบ ัะพัะบะฐะผ/ััะตะฝะฐะผ
4. **ะะธะฝะธะผะฐะปัะฝะฐั ะดะปะธะฝะฐ ััะตะฝั** (`minWallLength`): ะผะธะฝะธะผะฐะปัะฝะฐั ะดะพะฟัััะธะผะฐั ะดะปะธะฝะฐ
5. **ะััะพัะฐ ััะตะฝั ะฟะพ ัะผะพะปัะฐะฝะธั** (`defaultHeight`): ะฒััะพัะฐ ะฝะพะฒัั ััะตะฝ
6. **ะขะพะปัะธะฝะฐ ััะตะฝั ะฟะพ ัะผะพะปัะฐะฝะธั** (`defaultWidth`): ัะพะปัะธะฝะฐ ะฝะพะฒัั ััะตะฝ

ะะฐัััะพะนะบะธ ััะฐะฝัััั ะฒ `InteractionContext` ะธ ะผะพะณัั ะฑััั ะธะทะผะตะฝะตะฝั ัะตัะตะท UI (Settings panel).

---

## ะกะฒัะทั ั ัััะตััะฒัััะตะน ะฐััะธัะตะบัััะพะน

### ะคะฐะนะปั ะดะปั ัะพะทะดะฐะฝะธั/ะผะพะดะธัะธะบะฐัะธะธ

```
src/
โโโ threeApp/
โ   โโโ interaction/
โ   โ   โโโ modes/
โ   โ   โ   โโโ WallCreationMode.ts         ๐ ะกะะะะะขะฌ
โ   โ   โ
โ   โ   โโโ features/
โ   โ   โ   โโโ walls/
โ   โ   โ       โโโ WallFeature.ts          ๐ ะกะะะะะขะฌ
โ   โ   โ       โโโ WallCreationHandler.ts  ๐ ะกะะะะะขะฌ
โ   โ   โ
โ   โ   โโโ behaviors/
โ   โ   โ   โโโ SnapBehavior.ts             ๐ ะกะะะะะขะฌ
โ   โ   โ   โโโ WallPreviewBehavior.ts      ๐ ะกะะะะะขะฌ
โ   โ   โ
โ   โ   โโโ commands/
โ   โ       โโโ CreateWallCommand.ts        ๐ ะกะะะะะขะฌ
โ   โ       โโโ SplitWallCommand.ts         ๐ ะกะะะะะขะฌ
โ   โ
โ   โโโ house/
โ       โโโ walls/
โ           โโโ WallsManager.ts             โ๏ธ ะะะะะคะะฆะะะะะะขะฌ
โ               โโโ + createWall()
โ               โโโ + splitWall()
โ               โโโ + wallExistsBetween()
โ
โโโ ui/
โ   โโโ RightPanel.ts                       โ๏ธ ะะะะะคะะฆะะะะะะขะฌ
โ   โ   โโโ + createWallButton
โ   โ   โโโ + activateWallCreation()
โ   โ
โ   โโโ WallCreationHint.ts                 ๐ ะกะะะะะขะฌ
โ
โโโ api/
    โโโ apiLocal/
        โโโ ApiUiToThree.ts                 โ๏ธ ะะะะะคะะฆะะะะะะขะฌ
        โ   โโโ + activateWallCreationMode()
        โ   โโโ + deactivateWallCreationMode()
        โ
        โโโ ApiThreeToUi.ts                 โ๏ธ ะะะะะคะะฆะะะะะะขะฌ
            โโโ + onWallCreated()
            โโโ + onWallCreationError()
```

---

## ะัะธะพัะธัะตั ัะตะฐะปะธะทะฐัะธะธ

### ะญัะฐะฟ 1: MVP (ะผะธะฝะธะผะฐะปัะฝัะน ััะฝะบัะธะพะฝะฐะป)
1. โ ะะฝะพะฟะบะฐ ะฒ UI
2. โ ะะบัะธะฒะฐัะธั ัะตะถะธะผะฐ WallCreationMode
3. โ ะะตัะฒัะน ะบะปะธะบ โ ัะพะทะดะฐะฝะธะต ะฒัะตะผะตะฝะฝะพะน ัะพัะบะธ
4. โ Preview ััะตะฝั ะฟัะธ ะดะฒะธะถะตะฝะธะธ ะผััะธ
5. โ ะัะพัะพะน ะบะปะธะบ โ ัะพะทะดะฐะฝะธะต ััะตะฝั (ัะพะปัะบะพ ัะปััะฐะน C: ะฟัััะพะต ะผะตััะพ)
6. โ ะัะผะตะฝะฐ ะฟะพ ESC

### ะญัะฐะฟ 2: ะะฐััะธัะตะฝะฝัะน ััะฝะบัะธะพะฝะฐะป
1. โ Snap to existing points (ัะปััะฐะน A)
2. โ Continuous drawing mode
3. โ Dimension labels
4. โ Min length validation

### ะญัะฐะฟ 3: ะัะพะดะฒะธะฝัััะน ััะฝะบัะธะพะฝะฐะป
1. โ Split walls (ัะปััะฐะน B)
2. โ Snap to grid
3. โ Snap to walls
4. โ Undo/Redo support

### ะญัะฐะฟ 4: ะะพะปะธัะพะฒะบะฐ
1. โ ะะฐัััะพะนะบะธ ัะตะถะธะผะฐ ะฒ UI
2. โ ะะฒัะบะพะฒัะต ัััะตะบัั
3. โ ะะฝะธะผะฐัะธะธ ะธ transitions
4. โ Keyboard shortcuts (W ะดะปั ะฐะบัะธะฒะฐัะธะธ ัะตะถะธะผะฐ)

---

## ะะฐะบะปััะตะฝะธะต

ะะตะถะธะผ ัะพะทะดะฐะฝะธั ััะตะฝั ัะปะตะดัะตั ะฟะฐััะตัะฝั **Tool Mode** ั ะดะฒััะบะปะธะบะพะฒัะผ workflow ะธ ะฟัะพะดะฒะธะฝัััะผะธ ะฒะพะทะผะพะถะฝะพัััะผะธ snap/preview. ะััะธัะตะบัััะฐ ะธะฝัะตะณัะธััะตััั ั ัััะตััะฒัััะตะน ัะธััะตะผะพะน interaction/modes ะธ ะธัะฟะพะปัะทัะตั command pattern ะดะปั ะฟะพะดะดะตัะถะบะธ Undo/Redo.
