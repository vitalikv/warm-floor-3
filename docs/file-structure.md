# Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
src/
â”œâ”€â”€ main.ts                            # ğŸš€ Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”œâ”€â”€ core/
â”‚   â””â”€â”€ ContextSingleton.ts           # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ´Ğ»Ñ ÑĞ¸Ğ½Ğ³Ğ»Ñ‚Ğ¾Ğ½Ğ¾Ğ²
â”‚
â”œâ”€â”€ threeApp/
â”‚   â”œâ”€â”€ ThreeMain.ts                  # ğŸ¯ Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Three.js
â”‚   â”‚
â”‚   â”œâ”€â”€ scene/                         # ğŸ¬ Ğ‘ĞĞ—ĞĞ’Ğ«Ğ™ Ğ¤Ğ£ĞĞšĞ¦Ğ˜ĞĞĞĞ› Ğ¡Ğ¦Ğ•ĞĞ«
â”‚   â”‚   â”œâ”€â”€ SceneManager.ts           # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ THREE.Scene
â”‚   â”‚   â”œâ”€â”€ RendererManager.ts        # WebGL Ñ€ĞµĞ½Ğ´ĞµÑ€ĞµÑ€
â”‚   â”‚   â”œâ”€â”€ CameraManager.ts          # Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ°Ñ ĞºĞ°Ğ¼ĞµÑ€Ğ° (2D/3D)
â”‚   â”‚   â”œâ”€â”€ ControlsManager.ts        # OrbitControls
â”‚   â”‚   â”œâ”€â”€ LightsManager.ts          # ĞÑĞ²ĞµÑ‰ĞµĞ½Ğ¸Ğµ
â”‚   â”‚   â”œâ”€â”€ GridHelper.ts             # Ğ¡ĞµÑ‚ĞºĞ° Ğ¸ Ğ²ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹
â”‚   â”‚   â””â”€â”€ PostProcessing.ts         # ĞŸĞ¾ÑÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° (outline, etc.)
â”‚   â”‚
â”‚   â”œâ”€â”€ house/                         # ğŸ  Ğ›ĞĞ“Ğ˜ĞšĞ ĞŸĞĞ¡Ğ¢Ğ ĞĞ•ĞĞ˜Ğ¯ Ğ”ĞĞœĞ
â”‚   â”‚   â”œâ”€â”€ HouseManager.ts           # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ´Ğ¾Ğ¼Ğ° (Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€)
â”‚   â”‚   â”œâ”€â”€ HouseLoader.ts            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ¾Ğ¼Ğ° Ğ¸Ğ· JSON + Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ° Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ levels/                    # ğŸ¢ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑÑ‚Ğ°Ğ¶ĞµĞ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ LevelManager.ts       # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ¶Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Level.ts              # ĞšĞ»Ğ°ÑÑ ÑÑ‚Ğ°Ğ¶Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ LevelContext.ts       # ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ğ¶Ğ°
â”‚   â”‚   â”‚   â””â”€â”€ LevelVisibility.ts    # Ğ’Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ ÑÑ‚Ğ°Ğ¶ĞµĞ¹ (ghost/hidden)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ points/                    # ğŸ“ Ğ¢Ğ¾Ñ‡ĞºĞ¸ (Ğ²ĞµÑ€ÑˆĞ¸Ğ½Ñ‹ ÑÑ‚ĞµĞ½)
â”‚   â”‚   â”‚   â”œâ”€â”€ PointsManager.ts      # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ñ‡ĞºĞ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Point.ts              # ĞšĞ»Ğ°ÑÑ Ñ‚Ğ¾Ñ‡ĞºĞ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ PointMesh.ts          # Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
â”‚   â”‚   â”‚   â””â”€â”€ PointFactory.ts       # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ñ‡ĞµĞº
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ walls/                     # ğŸ§± Ğ¡Ñ‚ĞµĞ½Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ WallsManager.ts       # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚ĞµĞ½Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Wall.ts               # ĞšĞ»Ğ°ÑÑ ÑÑ‚ĞµĞ½Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ WallGeometry.ts       # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ³ĞµĞ¾Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ¸ ÑÑ‚ĞµĞ½Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ WallMaterial.ts       # ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹ ÑÑ‚ĞµĞ½
â”‚   â”‚   â”‚   â””â”€â”€ WallFactory.ts        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‚ĞµĞ½
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ rooms/                     # ğŸšª ĞšĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomsManager.ts       # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Room.ts               # ĞšĞ»Ğ°ÑÑ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomDetector.ts       # ĞĞ²Ñ‚Ğ¾Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚ Ğ¿Ğ¾ ÑÑ‚ĞµĞ½Ğ°Ğ¼
â”‚   â”‚   â”‚   â””â”€â”€ RoomFloor.ts          # ĞŸĞ¾Ğ» ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ openings/                  # ğŸšªğŸªŸ Ğ”Ğ²ĞµÑ€Ğ¸ Ğ¸ Ğ¾ĞºĞ½Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ OpeningsManager.ts    # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ‘Ğ¼Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Door.ts               # ĞšĞ»Ğ°ÑÑ Ğ´Ğ²ĞµÑ€Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Window.ts             # ĞšĞ»Ğ°ÑÑ Ğ¾ĞºĞ½Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ OpeningPlacer.ts      # Ğ Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ÑÑ‚ĞµĞ½Ğµ
â”‚   â”‚   â”‚   â””â”€â”€ OpeningCutter.ts      # Ğ’Ñ‹Ñ€ĞµĞ·Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ‘Ğ¼Ğ¾Ğ² Ğ² ÑÑ‚ĞµĞ½Ğµ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ objects/                   # ğŸª‘ ĞœĞµĞ±ĞµĞ»ÑŒ Ğ¸ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectsManager.ts     # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ FurnitureObject.ts    # ĞšĞ»Ğ°ÑÑ Ğ¼ĞµĞ±ĞµĞ»Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectCatalog.ts      # ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²
â”‚   â”‚   â”‚   â””â”€â”€ ObjectPlacer.ts       # Ğ Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ roofs/                     # ğŸ  ĞšÑ€Ñ‹ÑˆĞ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ RoofsManager.ts       # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑ€Ñ‹ÑˆĞ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Roof.ts               # ĞšĞ»Ğ°ÑÑ ĞºÑ€Ñ‹ÑˆĞ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ RoofGeometry.ts       # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ³ĞµĞ¾Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ¸
â”‚   â”‚   â”‚   â””â”€â”€ RoofTypes.ts          # Ğ¢Ğ¸Ğ¿Ñ‹ ĞºÑ€Ñ‹Ñˆ (Ğ¿Ğ»Ğ¾ÑĞºĞ°Ñ, Ğ´Ğ²ÑƒÑĞºĞ°Ñ‚Ğ½Ğ°Ñ, etc.)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ stairs/                    # ğŸªœ Ğ›ĞµÑÑ‚Ğ½Ğ¸Ñ†Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ StairsManager.ts      # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ»ĞµÑÑ‚Ğ½Ğ¸Ñ†Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Stairway.ts           # ĞšĞ»Ğ°ÑÑ Ğ»ĞµÑÑ‚Ğ½Ğ¸Ñ†Ñ‹
â”‚   â”‚   â”‚   â””â”€â”€ StairTypes.ts         # Ğ¢Ğ¸Ğ¿Ñ‹ Ğ»ĞµÑÑ‚Ğ½Ğ¸Ñ†
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ floors/                    # ğŸŸ« ĞŸĞµÑ€ĞµĞºÑ€Ñ‹Ñ‚Ğ¸Ñ
â”‚   â”‚       â”œâ”€â”€ FloorsManager.ts      # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞºÑ€Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸
â”‚   â”‚       â”œâ”€â”€ FloorSlab.ts          # ĞŸĞ»Ğ¸Ñ‚Ğ° Ğ¿ĞµÑ€ĞµĞºÑ€Ñ‹Ñ‚Ğ¸Ñ
â”‚   â”‚       â””â”€â”€ FloorOpening.ts       # ĞŸÑ€Ğ¾Ñ‘Ğ¼Ñ‹ Ğ² Ğ¿ĞµÑ€ĞµĞºÑ€Ñ‹Ñ‚Ğ¸ÑÑ…
â”‚   â”‚
â”‚   â”œâ”€â”€ interaction/                   # ğŸ–±ï¸ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ Ğ’Ğ—ĞĞ˜ĞœĞĞ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ™
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ InteractionOrchestrator.ts  # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ğ¾Ñ€
â”‚   â”‚   â”‚   â”œâ”€â”€ EventBus.ts                 # Event Bus Ğ´Ğ»Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ InteractionContext.ts       # Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
â”‚   â”‚   â”‚   â””â”€â”€ CursorManager.ts            # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑƒÑ€ÑĞ¾Ñ€Ğ¾Ğ¼
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ input/                     # ğŸ“¥ Ğ¡Ğ»Ğ¾Ğ¹ Ğ²Ğ²Ğ¾Ğ´Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ MouseInputManager.ts  # Mouse/touch ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ KeyboardInputManager.ts # ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ°
â”‚   â”‚   â”‚   â””â”€â”€ GestureDetector.ts    # Ğ–ĞµÑÑ‚Ñ‹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routing/                   # ğŸš¦ Ğ¡Ğ»Ğ¾Ğ¹ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ ClickRouter.ts        # ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ RaycastService.ts     # Centralized raycasting
â”‚   â”‚   â”‚   â””â”€â”€ ObjectIdentifier.ts   # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ° Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ modes/                     # ğŸ¨ Ğ ĞµĞ¶Ğ¸Ğ¼Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ ModeManager.ts        # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Mode.ts               # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ Camera2DMode.ts       # 2D Ñ€ĞµĞ¶Ğ¸Ğ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ Camera3DMode.ts       # 3D Ñ€ĞµĞ¶Ğ¸Ğ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ ViewOnlyMode.ts       # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€
â”‚   â”‚   â”‚   â””â”€â”€ MeasureMode.ts        # Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğ¹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ policies/                  # ğŸ”’ ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ InteractionPolicy.ts  # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸Ğº
â”‚   â”‚   â”‚   â”œâ”€â”€ Camera2DPolicy.ts     # ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ»Ñ 2D
â”‚   â”‚   â”‚   â”œâ”€â”€ Camera3DPolicy.ts     # ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ»Ñ 3D
â”‚   â”‚   â”‚   â”œâ”€â”€ LevelPolicy.ts        # ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ»Ñ ÑÑ‚Ğ°Ğ¶ĞµĞ¹
â”‚   â”‚   â”‚   â””â”€â”€ PolicyRegistry.ts     # Ğ ĞµĞµÑÑ‚Ñ€ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸Ğº
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ capabilities/              # ğŸ§© Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² (Mixins)
â”‚   â”‚   â”‚   â”œâ”€â”€ Capability.ts         # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ Draggable.ts          # ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµÑ‚Ğ°ÑĞºĞ¸Ğ²Ğ°Ñ‚ÑŒ
â”‚   â”‚   â”‚   â”œâ”€â”€ Selectable.ts         # ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ²Ñ‹Ğ´ĞµĞ»ÑÑ‚ÑŒ
â”‚   â”‚   â”‚   â”œâ”€â”€ Snappable.ts          # ĞŸÑ€Ğ¸Ğ²ÑĞ·ĞºĞ° Ğº ÑĞµÑ‚ĞºĞµ
â”‚   â”‚   â”‚   â”œâ”€â”€ Resizable.ts          # Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°
â”‚   â”‚   â”‚   â”œâ”€â”€ Hoverable.ts          # ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Rotatable.ts          # ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ²Ñ€Ğ°Ñ‰Ğ°Ñ‚ÑŒ
â”‚   â”‚   â”‚   â”œâ”€â”€ Deletable.ts          # ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ
â”‚   â”‚   â”‚   â”œâ”€â”€ LevelBound.ts         # ĞŸÑ€Ğ¸Ğ²ÑĞ·ĞºĞ° Ğº ÑÑ‚Ğ°Ğ¶Ñƒ
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts              # Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ (applyCapabilities, hasCapability)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ features/                  # ğŸ­ Ğ¤Ğ¸Ñ‡Ğ¸ (Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²)
â”‚   â”‚   â”‚   â”œâ”€â”€ Feature.ts            # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ñ„Ğ¸Ñ‡Ğ¸
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ points/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PointFeature.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PointDragHandler.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PointSnapHandler.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ walls/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WallFeature.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WallDragHandler.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WallResizeHandler.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WallSplitHandler.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ rooms/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoomFeature.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RoomSelectHandler.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ objects/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectFeature.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectPlaceHandler.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ObjectDragHandler.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ObjectRotateHandler.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ openings/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OpeningFeature.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OpeningMoveHandler.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ OpeningResizeHandler.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ roofs/
â”‚   â”‚   â”‚       â”œâ”€â”€ RoofFeature.ts
â”‚   â”‚   â”‚       â””â”€â”€ RoofEditHandler.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ behaviors/                 # ğŸ”„ ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ DragBehavior.ts       # ĞĞ±Ñ‰Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° drag
â”‚   â”‚   â”‚   â”œâ”€â”€ SnapBehavior.ts       # ĞŸÑ€Ğ¸Ğ²ÑĞ·ĞºĞ° Ğº ÑĞµÑ‚ĞºĞµ/Ñ‚Ğ¾Ñ‡ĞºĞ°Ğ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ HoverBehavior.ts      # ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ OutlineBehavior.ts    # ĞĞ±Ğ²Ğ¾Ğ´ĞºĞ° Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ñ…
â”‚   â”‚   â”‚   â””â”€â”€ CollisionBehavior.ts  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ»Ğ»Ğ¸Ğ·Ğ¸Ğ¹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tools/                     # ğŸ› ï¸ Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ ToolManager.ts        # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ SelectionTool.ts      # Ğ’Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ (box selection)
â”‚   â”‚   â”‚   â”œâ”€â”€ MeasureTool.ts        # Ğ˜Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ TransformTool.ts      # Ğ¢Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ (pivot/rotate/scale)
â”‚   â”‚   â”‚   â””â”€â”€ SnapTool.ts           # ĞŸÑ€Ğ¸Ğ²ÑĞ·ĞºĞ°
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ commands/                  # â®ï¸ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Undo/Redo
â”‚   â”‚   â”‚   â”œâ”€â”€ CommandManager.ts     # Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
â”‚   â”‚   â”‚   â”œâ”€â”€ Command.ts            # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ MoveCommand.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ DeleteCommand.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ AddCommand.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ResizeCommand.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ TransformCommand.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ CreateLevelCommand.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ DeleteLevelCommand.ts
â”‚   â”‚   â”‚   â””â”€â”€ ChangeLevelCommand.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ blocking/                  # ğŸš« Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº
â”‚   â”‚       â”œâ”€â”€ BlockingManager.ts
â”‚   â”‚       â””â”€â”€ BlockingRules.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ loaders/                       # ğŸ“¦ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ñ‡Ğ¸ĞºĞ¸ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
â”‚   â”‚   â”œâ”€â”€ ModelLoader.ts            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° 3D Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
â”‚   â”‚   â”œâ”€â”€ TextureLoader.ts          # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‚ĞµĞºÑÑ‚ÑƒÑ€
â”‚   â”‚   â””â”€â”€ MaterialLibrary.ts        # Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²
â”‚   â”‚
â”‚   â””â”€â”€ worker/                       # ğŸ§µ Ğ Ğ•ĞĞ”Ğ•Ğ  Ğ’ Ğ’ĞĞ ĞšĞ•Ğ Ğ•
â”‚       â”œâ”€â”€ WorkerManager.ts          # Ğ¡Ñ‚Ğ¾Ñ€Ğ¾Ğ½Ğ° main-thread: ÑĞ¿Ğ°Ğ²Ğ½ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ°, bridge ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
â”‚       â”œâ”€â”€ RenderWorker.ts           # Ğ¡Ñ‚Ğ¾Ñ€Ğ¾Ğ½Ğ° Worker: Three.js ÑÑ†ĞµĞ½Ğ° + Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
â”‚       â””â”€â”€ WorkerTypes.ts            # Union-Ñ‚Ğ¸Ğ¿ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ main â†” worker
â”‚
â”œâ”€â”€ ui/                                # ğŸ–¼ï¸ UI ĞšĞĞœĞŸĞĞĞ•ĞĞ¢Ğ«
â”‚   â”œâ”€â”€ UiMain.ts                     # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ UI Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€
â”‚   â”‚
â”‚   â”œâ”€â”€ panels/
â”‚   â”‚   â”œâ”€â”€ TopPanel.ts               # Ğ’ĞµÑ€Ñ…Ğ½ÑÑ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ â†’ ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ JSON)
â”‚   â”‚   â”œâ”€â”€ LeftPanel.ts              # Ğ›ĞµĞ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³)
â”‚   â”‚   â”œâ”€â”€ RightPanel.ts             # ĞŸÑ€Ğ°Ğ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°)
â”‚   â”‚   â”œâ”€â”€ LevelPanel.ts             # ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑÑ‚Ğ°Ğ¶ĞµĞ¹
â”‚   â”‚   â””â”€â”€ PropertiesPanel.ts        # ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ² Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°
â”‚   â”‚
â”‚   â”œâ”€â”€ toolbar/
â”‚   â”‚   â”œâ”€â”€ Toolbar.ts                # ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
â”‚   â”‚   â””â”€â”€ ToolButton.ts             # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°
â”‚   â”‚
â”‚   â”œâ”€â”€ controls/
â”‚   â”‚   â”œâ”€â”€ CameraToggle.ts           # ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»ÑŒ 2D/3D
â”‚   â”‚   â”œâ”€â”€ UndoRedoButtons.ts        # ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹/Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ°
â”‚   â”‚   â””â”€â”€ ZoomControls.ts           # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·ÑƒĞ¼Ğ¾Ğ¼
â”‚   â”‚
â”‚   â””â”€â”€ dialogs/
â”‚       â”œâ”€â”€ ConfirmDialog.ts          # Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
â”‚       â””â”€â”€ SettingsDialog.ts         # Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº
â”‚
â”œâ”€â”€ api/                               # ğŸ”— API Ğ¡Ğ›ĞĞ™
â”‚   â”‚
â”‚   â”œâ”€â”€ apiGlobal/                     # ğŸŒ Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ñ Ğ²Ğ½ĞµÑˆĞ½ĞµĞ¹ Ğ‘Ğ”
â”‚   â”‚   â”œâ”€â”€ ApiGlobalLoader.ts         # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ¾Ğ¼Ğ° Ğ¸Ğ· Ğ²Ğ½ĞµÑˆĞ½ĞµĞ¹ Ğ‘Ğ” (GET)
â”‚   â”‚   â”œâ”€â”€ ApiGlobalSaver.ts          # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ´Ğ¾Ğ¼Ğ° Ğ² Ğ²Ğ½ĞµÑˆĞ½ÑÑ Ğ‘Ğ” (POST/PUT)
â”‚   â”‚   â””â”€â”€ ApiGlobalTypes.ts          # Ğ¢Ğ¸Ğ¿Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½ĞµĞ¹ Ğ‘Ğ”
â”‚   â”‚
â”‚   â””â”€â”€ apiLocal/                      # ğŸ“¨ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ UI Ğ¸ Three.js
â”‚       â”œâ”€â”€ ApiUiToThree.ts            # UI â†’ Three.js (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚ĞµĞ½Ñƒ, ÑĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ñ‡ĞºÑƒ, ÑĞ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ¶Ğ¸Ğ¼)
â”‚       â”œâ”€â”€ ApiThreeToUi.ts            # Three.js â†’ UI (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ², ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ)
â”‚       â””â”€â”€ ApiLocalTypes.ts           # Ğ¢Ğ¸Ğ¿Ñ‹ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ»Ğ¾ÑĞ¼Ğ¸
â”‚
â””â”€â”€ utils/                             # ğŸ”§ Ğ£Ğ¢Ğ˜Ğ›Ğ˜Ğ¢Ğ«
    â”œâ”€â”€ math/
    â”‚   â”œâ”€â”€ GeometryUtils.ts          # Ğ“ĞµĞ¾Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ
    â”‚   â”œâ”€â”€ VectorUtils.ts            # Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸
    â”‚   â””â”€â”€ PolygonUtils.ts           # Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ¿Ğ¾Ğ»Ğ¸Ğ³Ğ¾Ğ½Ğ°Ğ¼Ğ¸
    â”‚
    â”œâ”€â”€ helpers/
    â”‚   â”œâ”€â”€ DebugHelper.ts            # ĞÑ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹
    â”‚   â””â”€â”€ PerformanceMonitor.ts     # ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
    â”‚
    â””â”€â”€ types/
        â”œâ”€â”€ HouseTypes.ts             # Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ¼Ğ°
        â”œâ”€â”€ InteractionTypes.ts       # Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ»Ñ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹
        â””â”€â”€ EventTypes.ts             # Ğ¢Ğ¸Ğ¿Ñ‹ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
```

---

## API ÑĞ»Ğ¾Ğ¹ â€” ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹

### apiGlobal â€” Ğ²Ğ½ĞµÑˆĞ½ÑÑ Ğ‘Ğ”

ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½ĞµĞ½ Ğ·Ğ° Ğ²ÑÑ‘, Ñ‡Ñ‚Ğ¾ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ ÑĞµÑ€Ğ²ĞµÑ€Ğ½Ğ¾Ğ¹ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹. UI Ğ¸ Three.js Ğ½Ğµ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ â€” Ğ²ÑÑ‘ Ñ‡ĞµÑ€ĞµĞ· ÑÑ‚Ğ¾Ñ‚ ÑĞ»Ğ¾Ğ¹.

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------|-------------|------------|
| `ApiGlobalLoader` | Ğ‘Ğ” â†’ App | Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ´Ğ¾Ğ¼Ğ° (ÑĞ¿Ğ¸ÑĞ¾Ğº ÑÑ‚Ğ°Ğ¶ĞµĞ¹, ÑÑ‚ĞµĞ½, Ñ‚Ğ¾Ñ‡ĞµĞº, Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²) |
| `ApiGlobalSaver` | App â†’ Ğ‘Ğ” | Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ Ğ² Ğ‘Ğ” |
| `ApiGlobalTypes` | â€” | DTO Ğ¸ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ², Ğ¾Ğ±Ñ‰Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ… ĞºĞ»Ğ°ÑÑĞ¾Ğ² |

ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½: Ğ¾Ğ±Ğ° ĞºĞ»Ğ°ÑÑĞ° â€” `ContextSingleton`, Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ñ‡ĞµÑ€ĞµĞ· `.inst()`. Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¾Ğ½Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ `fetch` (Ğ¸Ğ»Ğ¸ Ğ¸Ñ‚Ğ¾Ğ³ ĞµĞ³Ğ¾ Ğ¾Ğ±Ñ‘Ñ€Ñ‚ĞºĞ¸) Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ Promise. Ğ•ÑĞ»Ğ¸ Ğ² Ğ´Ğ°Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞµĞ¼ Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ WebSocket (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ´Ğ»Ñ real-time ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸), Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ ÑÑĞ´Ğ° Ğ¶Ğµ.

### apiLocal â€” ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ UI â†” Three.js

Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° ÑĞ»Ğ¾Ñ â€” ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¼ĞµĞ¶Ğ´Ñƒ UI Ğ¸ Three.js, Ğ¸ÑĞºĞ»ÑÑ‡Ğ°Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ½Ğ¸Ğ¼Ğ¸. ĞĞ½Ğ°Ğ»Ğ¾Ğ³ ÑÑ…ĞµĞ¼Ñ‹ Ğ¸Ğ· `tp-viewer3D`: Ñ‚Ğ°Ğ¼ `ApiUiToThree` Ğ¸ `ApiThreeToUi` Ñ‚Ğ°ĞºĞ¶Ğµ ÑĞ²Ğ»ÑÑÑ‚ÑÑ ÑĞ¸Ğ½Ğ³Ğ»Ñ‚Ğ¾Ğ½Ğ°Ğ¼Ğ¸ Ğ¸ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ¸Ñ€ÑƒÑÑ‚ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ğ»Ğ¸Ğ±Ğ¾ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ, Ğ»Ğ¸Ğ±Ğ¾ Ñ‡ĞµÑ€ĞµĞ· `postMessage` Ğ² Worker.

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ | ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ |
|------|-------------|----------------|
| `ApiUiToThree` | UI â†’ Three.js | `addWall()`, `movePoint()`, `deleteObject()`, `switchCameraMode()` |
| `ApiThreeToUi` | Three.js â†’ UI | `onPointSelected()`, `onWallUpdated()`, `updateProperties()` |
| `ApiLocalTypes` | â€” | Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ |

ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾: ĞµÑĞ»Ğ¸ UI Ğ½ÑƒĞ¶Ğ´Ğ°ĞµÑ‚ÑÑ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· ÑÑ†ĞµĞ½Ñ‹ â€” Ğ¾Ğ½ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ¾Ğ´ Ğ½Ğ° `ApiUiToThree` (Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ) Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ñ… Ñ‡ĞµÑ€ĞµĞ· ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ¾Ñ‚ `ApiThreeToUi` (push). ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ² Three.js Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² `ui/` Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½.

---

## Ğ ĞµĞ½Ğ´ĞµÑ€ Ğ² Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğµ â€” Ğ´Ğ²Ğ° Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°

Ğ¡Ñ…ĞµĞ¼Ğ° ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ¸Ğ· `tp-viewer3D`. ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° ÑÑ‚Ğ°Ñ€Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· Ñ„Ğ»Ğ°Ğ³ `useWorker` (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ `true`). ĞĞ±Ğ° Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑÑ‚ Ğ¾Ğ´Ğ½Ñƒ Ğ¸ Ñ‚Ñƒ Ğ¶Ğµ ÑÑ†ĞµĞ½Ñƒ Ñ‡ĞµÑ€ĞµĞ· Ğ¾Ğ±Ñ‰ÑƒÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `InitScene` â€” Ñ€Ğ°ÑÑ…Ğ¾Ğ´ÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ñ‚Ğ¾Ğ¼, Ğ³Ğ´Ğµ Ğ¾Ğ½Ğ° Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ° Ğ¸ ĞºĞ°Ğº Ğ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ.

### Ğ ĞµĞ¶Ğ¸Ğ¼ 1: Worker (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)

```
main thread                                  Worker
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
canvas (DOM)                                 OffscreenCanvas
   â”‚                                            â”‚
   â”œâ”€ transferControlToOffscreen() â”€â”€â”€â”€â”€â”€â”€â–º     â”‚
   â”‚                                            â”œâ”€ InitScene.init()   â† Three.js ÑÑ†ĞµĞ½Ğ°
   â”‚                                            â”œâ”€ SceneManager
   â”‚                                            â”œâ”€ RendererManager    â† Ñ€ĞµĞ½Ğ´ĞµÑ€ Ñ‚ÑƒÑ‚
   â”‚                                            â””â”€ Ğ²ÑĞµ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñ‹
   â”‚
   â”œâ”€ pointer/wheel events â”€â”€postMessage()â”€â”€â–º  RenderWorker.handleMessage()
   â”‚                                            â””â”€ proxies to controls + MouseManager
   â”‚
   â”œâ”€ UI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°
   â”‚   â””â”€ ApiUiToThree.inst().addWall()
   â”‚       â””â”€ WorkerManager.worker
   â”‚           .postMessage({ type })  â”€â”€â”€â–º     â””â”€ Ğ²Ñ‹Ğ·Ğ¾Ğ² Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ° Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
   â”‚
   â—„â”€â”€ self.postMessage({ type }) â”€â”€â”€â”€â”€â”€â”€â”€â”€    RenderWorker â†’ UI ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ
   â”‚       â””â”€ WorkerManager.onmessage()
   â”‚           â””â”€ ApiThreeToUi â†’ UI ĞºĞ»Ğ°ÑÑ
   â”‚
   â”œâ”€ resize (ResizeObserver)  â”€â”€postMessage()â”€â”€â–º  SceneManager.handleResize()
```

ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:

| Ğ¤Ğ°Ğ¹Ğ» | Ğ Ğ¾Ğ»ÑŒ |
|------|------|
| `WorkerManager` | Main-thread ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ°: ÑĞ¿Ğ°Ğ²Ğ½Ğ¸Ñ‚ Worker, Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ OffscreenCanvas, Ğ¿ĞµÑ€ĞµÑ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ pointer-ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ñ canvas Ğ¸ forwarding-Ğ¸Ñ‚ Ğ¸Ñ…, Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ Worker Ğ¸ Ğ·Ğ¾Ğ²Ñ‘Ñ‚ UI |
| `RenderWorker` | Worker ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ°: Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ OffscreenCanvas, Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ `InitScene`, Ñ€ĞµĞ°Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ° Ğ²ÑĞµ `postMessage` ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹, Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñ‹ Three.js Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ |
| `WorkerTypes` | `type WorkerMessage = { type: 'init' â€¦ } \| { type: 'movePoint' â€¦ } \| â€¦` â€” ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ union Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ¾Ğ±Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹ |
| `ApiUiToThree` | Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸ `shouldUseWorker()`: ĞµÑĞ»Ğ¸ Ğ²Ğ¾Ñ€ĞºĞµÑ€ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ â€” ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¸Ğ´Ñ‘Ñ‚ Ñ‡ĞµÑ€ĞµĞ· `WorkerManager.worker.postMessage`, Ğ¸Ğ½Ğ°Ñ‡Ğµ â€” Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ² Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ° |
| `ApiThreeToUi` | Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸ `isInWorker()`: ĞµÑĞ»Ğ¸ ĞºĞ¾Ğ´ ĞºÑ€ÑƒÑ‚Ğ¸Ñ‚ÑÑ Ğ² Worker â€” `self.postMessage`, Ğ¸Ğ½Ğ°Ñ‡Ğµ â€” Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ² UI |

### Ğ ĞµĞ¶Ğ¸Ğ¼ 2: Main thread (`useWorker: false`)

```
main thread
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
canvas (DOM)
   â”‚
   â”œâ”€ InitScene.init()   â† Three.js ÑÑ†ĞµĞ½Ğ° Ğ·Ğ´ĞµÑÑŒ Ğ¶Ğµ
   â”œâ”€ SceneManager / RendererManager / Ğ²ÑĞµ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñ‹
   â”‚
   â”œâ”€ pointer events â†’ MouseManager Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ (Ñ‡ĞµÑ€ĞµĞ· DOM listener)
   â”‚
   â”œâ”€ ApiUiToThree.addWall() â†’ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ  (shouldUseWorker = false)
   â”œâ”€ ApiThreeToUi.onPointSelected() â†’ UI Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ (isInWorker = false)
   â”‚
   â””â”€ resize â†’ SceneManager.handleResize() Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
```

ĞĞµÑ‚ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ°, Ğ½ĞµÑ‚ OffscreenCanvas, Ğ½ĞµÑ‚ `postMessage`. Ğ£Ğ´Ğ¾Ğ±ĞµĞ½ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ Ğ¸ Ğ´Ğ»Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¹, Ğ³Ğ´Ğµ Worker Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.

### Ğ¡Ğ±Ğ¾Ñ€ĞºĞ°

Ğ”Ğ»Ñ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ° Ğ½ÑƒĞ¶Ğ½Ğ° Ğ²Ñ‚Ğ¾Ñ€Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Vite, Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³ `vite.worker.config.ts` Ğ¸Ğ· `tp-viewer3D`:

| ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ | Entry | Output |
|--------|-------|--------|
| `vite.config.ts` | `src/main.ts` | `dist/index.js` (Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ) |
| `vite.worker.config.ts` | `src/threeApp/worker/RenderWorker.ts` | `dist/worker.js` (Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ°Ğ½Ğ´Ğ») |

`WorkerManager` Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²Ğ¾Ñ€ĞºĞµÑ€ Ñ‡ĞµÑ€ĞµĞ· `new Worker(url, { type: 'module' })`. Ğ’ dev-Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ URL = `import.meta.url`-Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğº `.ts` Ñ„Ğ°Ğ¹Ğ»Ñƒ (Vite Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚), Ğ² prod â€” Ğ·Ğ°Ğ¼ĞµĞ½Ğ° `index.js` â†’ `worker.js` Ğ² Ñ‚Ğ¾Ğ¼ Ğ¶Ğµ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğµ.
